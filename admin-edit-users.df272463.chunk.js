"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[4263],{32739:(R,d,e)=>{e.d(d,{R:()=>r});var t=e(27279),a=e(87006),o=e(40464);function r(f={},c={}){const{id:n="",...g}=f,{get:E}=(0,a.kY)(),{data:s,isError:l,isLoading:M,refetch:L}=(0,o.useQuery)(["users",n,g],async()=>{const{data:{data:m}}=await E(`/admin/users/${n}`,{params:g});return m},c);return{users:t.useMemo(()=>{let m=[];return s&&("results"in s?Array.isArray(s.results)&&(m=s.results):m=[s]),m},[s]),pagination:t.useMemo(()=>(s&&"pagination"in s)??null,[s]),isLoading:M,isError:l,refetch:L}}},93552:(R,d,e)=>{e.r(d),e.d(d,{default:()=>le});var t=e(27279),a=e(87006),o=e(59461),r=e(51447),f=e(36364),c=e(73354),n=e(27875),g=e(48102),E=e(74758),s=e(93415),l=e(10701),M=e(32370),L=e(23298),O=e(74577),m=e(59082),B=e(76827),W=e(71563),I=e(98934),S=e.n(I),$=e(74919),N=e.n($),j=e(47184),y=e.n(j),Y=e(70627),H=e.n(Y),X=e(61020),V=e(32739),G=e(48232),v=e(42678),b=e(13657),te=e(30164),ae=e(85243),se=e(39394);const ne=async(A,u)=>{const{put:T}=(0,a.tg)(),{data:U}=await T(`/admin/users/${A}`,u);return U.data},oe=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],w=["email","firstname","lastname","username","isActive","roles"],k=({canUpdate:A})=>{const{formatMessage:u}=(0,X.Z)(),{params:{id:T}}=(0,r.$B)("/settings/users/:id"),{push:U}=(0,r.k6)(),{setUserDisplayName:K}=(0,a.L7)(),P=(0,a.lm)(),{lockApp:Q,unlockApp:J}=(0,a.o1)(),_=(0,G.c)(te.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE);(0,a.go)();const{users:[Z],isLoading:ie}=(0,V.R)({id:T},{cacheTime:0,onError(i){const{status:p}=i.response;p===403?(P({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),U("/")):P({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),de=async(i,p)=>{Q();try{const h=await ne(T,N()(i,"confirmPassword"));P({type:"success",message:u({id:"notification.success.saved",defaultMessage:"Saved"})});const C=a.I8.getUserInfo();if(T.toString()===C.id.toString()){a.I8.setUserInfo(h);const x=S()(i,"username")||(0,b.P)(i.firstname,i.lastname);K(x)}p.setValues(y()(i,w))}catch(h){const C=(0,v.I)(h.response.data),x=Object.keys(C).reduce((F,D)=>(F[D]=C[D].id,F),{});p.setErrors(x),P({type:"warning",message:S()(h,"response.data.error.message","notification.error")})}J()},q=ie||!_,ce=q?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},z=Object.keys(y()(Z,w)).reduce((i,p)=>p==="roles"?(i[p]=(Z?.roles||[]).map(({id:h})=>h),i):(i[p]=Z?.[p],i),{}),me=z.username||(0,b.P)(z.firstname,z.lastname),ee=u(ce,{name:me});return q?t.createElement(c.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"Users"}),t.createElement(n.T,{primaryAction:t.createElement(g.z,{disabled:!0,startIcon:t.createElement(m.Z,null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:ee,navigationAction:t.createElement(a.rU,{startIcon:t.createElement(B.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(E.D,null,t.createElement(a.dO,null))):t.createElement(c.o,null,t.createElement(a.SL,{name:"Users"}),t.createElement(W.J9,{onSubmit:de,initialValues:z,validateOnChange:!1,validationSchema:se.YM},({errors:i,values:p,handleChange:h,isSubmitting:C,dirty:x})=>t.createElement(a.l0,null,t.createElement(n.T,{primaryAction:t.createElement(g.z,{disabled:C||!A?!0:!x,startIcon:t.createElement(m.Z,null),loading:C,type:"submit",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:ee,navigationAction:t.createElement(a.rU,{startIcon:t.createElement(B.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(E.D,null,Z?.registrationToken&&t.createElement(s.x,{paddingBottom:6},t.createElement(_,{registrationToken:Z.registrationToken})),t.createElement(l.k,{direction:"column",alignItems:"stretch",gap:7},t.createElement(s.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(M.Z,{variant:"delta",as:"h2"},u({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(L.r,{gap:5},oe.map(F=>F.map(D=>t.createElement(O.P,{key:D.name,...D.size},t.createElement(a.jm,{...D,disabled:!A,error:i[D.name],onChange:h,value:p[D.name]||""}))))))),t.createElement(s.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(M.Z,{variant:"delta",as:"h2"},u({id:"global.roles",defaultMessage:"User's role"})),t.createElement(L.r,{gap:5},t.createElement(O.P,{col:6,xs:12},t.createElement(ae.Z,{disabled:!A,error:i.roles,onChange:h,value:p.roles}))))))))))};k.propTypes={canUpdate:H().bool.isRequired};const re=k,le=()=>{const A=(0,a.lm)(),u=(0,o.v9)(f._),T=t.useMemo(()=>({read:u.settings.users.read,update:u.settings.users.update}),[u.settings.users]),{isLoading:U,allowedActions:{canRead:K,canUpdate:P}}=(0,a.ss)(T),{state:Q}=(0,r.TH)(),J=Q?.from??"/";return(0,t.useEffect)(()=>{U||!K&&!P&&A({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[U,K,P,A]),U?t.createElement(a.dO,null):!K&&!P?t.createElement(r.l_,{to:J}):t.createElement(re,{canUpdate:P})}},6324:(R,d,e)=>{e.d(d,{Z:()=>E});var t=e(27279),a=e(4987),o=e(87006),r=e(78031),f=e(70627),c=e.n(f),n=e(61020);const g=({children:s,target:l})=>{const M=(0,o.lm)(),{formatMessage:L}=(0,n.Z)(),{copy:O}=(0,o.VP)(),m=L({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),B=async()=>{await O(l)&&M({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(o.Y_,{endAction:t.createElement(a.h,{label:m,noBorder:!0,icon:t.createElement(r.Z,null),onClick:B}),title:l,titleEllipsis:!0,subtitle:s,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};g.propTypes={children:c().oneOfType([c().element,c().string]).isRequired,target:c().string.isRequired};const E=g},30164:(R,d,e)=>{e.d(d,{A:()=>n});var t=e(27279),a=e(70627),o=e.n(a),r=e(61020),f=e(95651),c=e(6324);const n=({registrationToken:g})=>{const{formatMessage:E}=(0,r.Z)(),s=`${window.location.origin}${f.Z}auth/register?registrationToken=${g}`;return t.createElement(c.Z,{target:s},E({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:o().string}},85243:(R,d,e)=>{e.d(d,{Z:()=>B});var t=e(27279),a=e(5627),o=e(78955),r=e(87006),f=e(34547),c=e(70627),n=e.n(c),g=e(61020),E=e(40464),s=e(72450);const l=(0,s.F4)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,M=s.ZP.div`
  animation: ${l} 2s infinite linear;
`,L=()=>t.createElement(M,null,t.createElement(f.Z,null)),O=async()=>{const{get:W}=(0,r.tg)(),{data:I}=await W("/admin/roles");return I.data},m=({disabled:W,error:I,onChange:S,value:$})=>{const{status:N,data:j}=(0,E.useQuery)(["roles"],O,{staleTime:5e4}),{formatMessage:y}=(0,g.Z)(),Y=I?y({id:I,defaultMessage:I}):"",H=y({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),X=y({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),V=y({id:"app.components.Select.placeholder",defaultMessage:"Select"}),G=N==="loading"?t.createElement(L,null):void 0;return t.createElement(a.P,{id:"roles",disabled:W,error:Y,hint:X,label:H,name:"roles",onChange:v=>{S({target:{name:"roles",value:v}})},placeholder:V,multi:!0,startIcon:G,value:$.map(v=>v.toString()),withTags:!0,required:!0},(j||[]).map(v=>t.createElement(o.W,{key:v.id,value:v.id.toString()},y({id:`global.${v.code}`,defaultMessage:v.name}))))};m.defaultProps={disabled:!1,error:void 0},m.propTypes={disabled:n().bool,error:n().string,onChange:n().func.isRequired,value:n().array.isRequired};const B=m},39394:(R,d,e)=>{e.d(d,{YM:()=>E,Rw:()=>f});var t=e(47853),a=e(87006);const o={firstname:t.Z_().trim().required(a.I0.required),lastname:t.Z_(),email:t.Z_().email(a.I0.email).lowercase().required(a.I0.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.I0.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.I0.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(s,l)=>s?l.required(a.I0.required):l)},f={...o,currentPassword:t.Z_().when(["password","confirmPassword"],(s,l,M)=>s||l?M.required(a.I0.required):M),preferedLanguage:t.Z_().nullable()},n={roles:t.IX().min(1,a.I0.required).required(a.I0.required)},E=t.Ry().shape({...o,isActive:t.Xg(),...n})},76827:(R,d,e)=>{e.d(d,{Z:()=>o});var t=e(74081);const a=r=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...r,children:(0,t.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),o=a}}]);
